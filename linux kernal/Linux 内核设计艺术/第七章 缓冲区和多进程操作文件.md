
# 1. 背景
* 进程、文件系统、内存之间的操作都离不开缓冲区，理解缓冲区真正作用对理解操作系统非常重要。

# 2. 缓冲区作用
缓冲区作用体现在两方面
* 操作系统和各种设备解耦：设备挂载和操作系统设计都更加灵活
* 对设备文件操作运行效率更高


按理来说，设备和内存之间添加一个缓冲区，只会提高复制缓冲区开销，不可能提高效率的。快的原因是缓冲区的共享。
* 多个进程操作同一个文件共享，提高效率。
* 一段时间，一个进程多次操作一个文件共享。（概率是非常高的）

因此缓冲区的设计是围绕如何保证数据交互的正确性和如何让数据停留在缓冲区中竟可能长来设计的。


# 3. 缓冲区的总体结构图
![2019-09-02-09-18-17.png](./images/2019-09-02-09-18-17.png)
* 缓冲区中有两个非常重要的结构
    * buffer_head:负责进程和缓冲区数据交互，确保数据交互正确的前提下，让数据在缓冲区中停留更长时间。
    * request主要负责缓冲区和设备数据交互，确保正确交互前提下，及时的将设备数据同步到缓冲区中

![2019-09-02-09-24-53.png](./images/2019-09-02-09-24-53.png)
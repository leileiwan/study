[toc]
# 1. 背景
文件系统概念和操作。

# 2. 安装文件系统
* 操作系统加载了根文件系统，使操作系统能够以文件形式和根设备交互。
* 安装磁盘文件系统，就是将磁盘文件系统挂在根设备文件系统上。

安装文件系统分一下三步:
* 将磁盘中超级快读出来，并载入super_block[8]中
* 将虚拟盘指定i节点读出，并将此节点加载在系统中的inode_table[32]中
* 将系统中超级块挂接到inode_table[32]中指定的i节点上

我们常使用挂在文件系统命令是"mount /dev/hd1 /mnt"，意思试讲/dev/hd1设备挂在在/mnt目录下。
* 系统会启动mount()进程，并最终执行sys_mount()系统调用
* 磁盘是可以分区的，一个分区就是一个设备。这里我们将整个设备作为一个分区，具体后面讲述。

![2019-08-21-09-44-47.png](./images/2019-08-21-09-44-47.png)
![2019-08-21-09-45-25.png](./images/2019-08-21-09-45-25.png)

## 2.1 获取外设超级块
read_super()读取设备数据主要分为下面三步:
* super_block中选定一个空闲项来存储超级块
* 将超级块载入上面空闲项
* 根据超级块提供的的信息，载入i节点位图和逻辑块位图

加载超级快表项时需要加锁。
![2019-08-21-11-33-52.png](./images/2019-08-21-11-33-52.png)
![2019-08-21-11-34-17.png](./images/2019-08-21-11-34-17.png)
![2019-08-21-11-34-31.png](./images/2019-08-21-11-34-31.png)

## 2.2 确定根文件系统挂载点